 
## Item nonresponse: Examining missing data for variables within records 

**Reference Script**: completeness\\Completeness_values.Rmd

**Description**: This question looks at the absence of values for the variables that are part of the analysis. It is relevant to describe the dataset both in terms of the missingness of each variable and also in terms of units with at least one missing value in any key variable. In the case of longitudinal analysis units with missing values during the period of reference are also identified. It is also important to characterize units with missing data in terms of characteristics that are available to all units to assess possible biases.   
  
  
### Examining proportions of missing values

We plot two graphs in this analysis. The first one shows the proportion of missing values for each variable. The second one shows the number of times (y-axis) that different combinations of variables (x-axis) are missing, where the color red indicates the variables missing for that specific combination.

**Bar plots and missing value pattern matrix:**
```{r prop_miss_values_2}
# Bar plots and missing value pattern matrix:
subsetted_aggr = aggr(subset(subsetted,select=c(key_vars, domain_vars, id_vars, time_vars, location_vars)), numbers=TRUE, prop=c(TRUE,FALSE), cex.axis=.7, gap=3, ylab=c("Proportion of missingness","Missingness Pattern"))
```

**Interpretation**: The graph on the left shows the proportion of missing values for each variable.  Check if the missing values are concentrated in some variables and if these are key or domain variables.  
In some cases, it is possible that certain variables are missing together. For example, cases where a subsidy receipt indicator is missing may also have a missing value in the amount received. The graph on the right shows whether missing values are concentrated in one variable or in certain combinations of variables.  



### Units with at least one missing value

Here we graph the proportion of units with at least one missing value over time.

```{r units_miss_1}

subsetted$nmiss <- rowSums(is.na(subsetted)) #>=1
subsetted$nmiss[subsetted$nmiss>=1] <- 1
subsetted$nmiss <- as.factor(subsetted$nmiss)

# Frequency bar plots
time_units <- nlevels(as.factor(subsetted[[time_vars[1]]]))

if (time_units >= 15) {
    print(ggplot(data=subsetted, aes_string(x = as.factor(subsetted[[time_vars[1]]]), fill=subsetted$nmiss )) + 
            geom_bar(position="fill") + 
            theme_economist() + 
            scale_y_continuous(labels = scales::percent_format()) + 
            theme(axis.text.x = element_text(angle = 90, hjust = 1)) + 
            scale_x_discrete( breaks=function(x) x[seq(1, length(x), by=5)] ) +
            labs(x = "Time", y = "Proportion of units", fill="Missing") + 
            ggtitle(paste0("Prop. units with at least one missing value", ""), subtitle = paste0("Subset: ",subset_text )) ) 
} else {
      print(ggplot(data=subsetted, aes_string(x = as.factor(subsetted[[time_vars[1]]]), fill=subsetted$nmiss  )) +             
            geom_bar(position="fill") + 
            theme_economist() + 
            scale_y_continuous(labels = scales::percent_format()) +
            theme(axis.text.x = element_text(angle = 90, hjust = 1)) + 
            labs(x = "Time", y = "Proportion of units", fill="Missing") + 
            ggtitle(paste0("Prop. units with at least one missing value",""), subtitle = paste0("Subset: ",subset_text )) ) 
}


```

**Interpretation**: Check if units with missing values concentrated in certain months/years. When doing certain analysis, such as regression models, all units with at least one missing value would be excluded. In that case, what proportion of units would be excluded from the analysis? How is a longitudinal analysis affected by the missing value problem?  